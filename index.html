<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>EFT Calculator</title>
<link href="https://fonts.googleapis.com/css2?family=DM+Mono:wght@400;500&family=Lora:wght@600;700&family=Inter:wght@400;500;600&display=swap" rel="stylesheet">
<style>
  :root {
    --bg: #f4f6f9;
    --surface: #ffffff;
    --surface2: #eef1f6;
    --border: #d4d9e4;
    --border-hover: #b0b8cc;
    --accent: #1a6b4a;
    --accent-light: #e6f4ee;
    --accent2: #c0392b;
    --accent2-light: #fdecea;
    --accent3: #b5680a;
    --accent3-light: #fff4e0;
    --text: #1a1f2e;
    --text-muted: #6b7494;
    --text-subtle: #9aa3be;
    --radius: 12px;
    --shadow: 0 1px 4px rgba(0,0,0,0.07), 0 4px 16px rgba(0,0,0,0.05);
  }

  * { box-sizing: border-box; margin: 0; padding: 0; }

  body {
    background: var(--bg);
    color: var(--text);
    font-family: 'Inter', sans-serif;
    min-height: 100vh;
    padding: 2rem 1rem 4rem;
  }

  .container {
    max-width: 860px;
    margin: 0 auto;
  }

  header {
    margin-bottom: 2rem;
    padding-bottom: 1.5rem;
    border-bottom: 2px solid var(--border);
    display: flex;
    align-items: baseline;
    gap: 1rem;
    flex-wrap: wrap;
  }

  header h1 {
    font-family: 'Lora', serif;
    font-size: 2rem;
    font-weight: 700;
    letter-spacing: -0.02em;
    color: var(--accent);
  }

  header span {
    font-family: 'DM Mono', monospace;
    font-size: 0.75rem;
    color: var(--text-muted);
    letter-spacing: 0.1em;
    text-transform: uppercase;
  }

  .card {
    background: var(--surface);
    border: 1px solid var(--border);
    border-radius: var(--radius);
    padding: 1.75rem;
    margin-bottom: 1.25rem;
    box-shadow: var(--shadow);
    transition: border-color 0.2s;
  }

  .card:hover { border-color: var(--border-hover); }

  .card-title {
    font-size: 0.68rem;
    font-family: 'DM Mono', monospace;
    letter-spacing: 0.15em;
    text-transform: uppercase;
    color: var(--text-muted);
    margin-bottom: 1.25rem;
    display: flex;
    align-items: center;
    gap: 0.6rem;
  }

  .card-title::before {
    content: '';
    display: inline-block;
    width: 8px; height: 8px;
    border-radius: 50%;
    background: var(--accent);
    flex-shrink: 0;
  }

  .card-title.red::before { background: var(--accent2); }
  .card-title.yellow::before { background: var(--accent3); }

  label {
    display: block;
    font-size: 0.75rem;
    font-family: 'DM Mono', monospace;
    color: var(--text-muted);
    margin-bottom: 0.45rem;
    letter-spacing: 0.05em;
    text-transform: uppercase;
  }

  select, input[type="number"], input[type="date"] {
    width: 100%;
    background: var(--surface2);
    border: 1px solid var(--border);
    border-radius: 8px;
    color: var(--text);
    font-family: 'Inter', sans-serif;
    font-size: 0.95rem;
    padding: 0.7rem 1rem;
    outline: none;
    transition: border-color 0.2s, box-shadow 0.2s;
    appearance: none;
    -webkit-appearance: none;
  }

  select {
    cursor: pointer;
    background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='12' height='12' viewBox='0 0 12 12'%3E%3Cpath fill='%236b7494' d='M6 8L1 3h10z'/%3E%3C/svg%3E");
    background-repeat: no-repeat;
    background-position: right 1rem center;
    background-color: var(--surface2);
    padding-right: 2.5rem;
  }

  select:focus, input:focus {
    border-color: var(--accent);
    box-shadow: 0 0 0 3px rgba(26,107,74,0.12);
    background: #fff;
  }

  input[type="date"]::-webkit-calendar-picker-indicator {
    opacity: 0.5;
    cursor: pointer;
  }

  .row {
    display: grid;
    grid-template-columns: 1fr 1fr;
    gap: 1rem;
    margin-top: 1rem;
  }

  @media (max-width: 560px) { .row { grid-template-columns: 1fr; } }

  .field { margin-bottom: 1rem; }
  .field:last-child { margin-bottom: 0; }

  .result-box {
    background: var(--surface2);
    border: 1px solid var(--border);
    border-radius: 10px;
    padding: 1.25rem 1.5rem;
    margin-top: 1.25rem;
    display: flex;
    align-items: center;
    justify-content: space-between;
    gap: 1rem;
    flex-wrap: wrap;
  }

  .result-label {
    font-family: 'DM Mono', monospace;
    font-size: 0.68rem;
    color: var(--text-muted);
    text-transform: uppercase;
    letter-spacing: 0.1em;
    margin-bottom: 0.3rem;
  }

  .result-value {
    font-family: 'Lora', serif;
    font-size: 2.2rem;
    font-weight: 700;
    letter-spacing: -0.02em;
    color: var(--accent);
    line-height: 1;
  }

  .result-value.red { color: var(--accent2); }
  .result-value.yellow { color: var(--accent3); }

  .formula-text {
    font-family: 'DM Mono', monospace;
    font-size: 0.82rem;
    color: var(--text-muted);
  }

  .eft-badge {
    display: inline-flex;
    align-items: center;
    gap: 0.4rem;
    background: var(--accent-light);
    border: 1px solid rgba(26,107,74,0.2);
    border-radius: 6px;
    padding: 0.35rem 0.85rem;
    font-family: 'DM Mono', monospace;
    font-size: 0.8rem;
    color: var(--accent);
    margin-top: 0.75rem;
    font-weight: 500;
  }

  .toggle-row {
    display: flex;
    gap: 0.5rem;
    margin-bottom: 1.25rem;
  }

  .toggle-btn {
    flex: 1;
    background: var(--surface2);
    border: 1px solid var(--border);
    border-radius: 8px;
    color: var(--text-muted);
    font-family: 'Inter', sans-serif;
    font-size: 0.85rem;
    font-weight: 600;
    padding: 0.65rem 1rem;
    cursor: pointer;
    transition: all 0.2s;
  }

  .toggle-btn:hover { border-color: var(--border-hover); color: var(--text); }

  .toggle-btn.active {
    background: var(--accent-light);
    border-color: rgba(26,107,74,0.35);
    color: var(--accent);
  }

  .toggle-btn.active.red {
    background: var(--accent2-light);
    border-color: rgba(192,57,43,0.3);
    color: var(--accent2);
  }

  .mode-panel { display: none; }
  .mode-panel.visible { display: block; }

  .three-col {
    display: grid;
    grid-template-columns: 1fr 1fr 1fr;
    gap: 1rem;
    margin-top: 1rem;
  }

  @media (max-width: 640px) { .three-col { grid-template-columns: 1fr; } }

  .mini-stat {
    background: var(--surface2);
    border: 1px solid var(--border);
    border-radius: 8px;
    padding: 1rem 1.25rem;
    text-align: center;
  }

  .mini-stat .val {
    font-family: 'Lora', serif;
    font-size: 1.5rem;
    font-weight: 700;
    margin-bottom: 0.3rem;
    line-height: 1;
  }

  .mini-stat .lbl {
    font-family: 'DM Mono', monospace;
    font-size: 0.6rem;
    color: var(--text-muted);
    text-transform: uppercase;
    letter-spacing: 0.08em;
  }

  .date-note {
    font-size: 0.82rem;
    color: var(--text-muted);
    margin-top: 0.85rem;
    line-height: 1.7;
  }

  .date-note strong { color: var(--text); font-weight: 600; }

  .shutdown-note {
    display: flex;
    align-items: flex-start;
    gap: 0.6rem;
    background: var(--accent3-light);
    border: 1px solid rgba(181,104,10,0.2);
    border-radius: 8px;
    padding: 0.75rem 1rem;
    margin-top: 1rem;
    font-size: 0.8rem;
    color: var(--accent3);
    line-height: 1.5;
  }

  .shutdown-note .icon { flex-shrink: 0; font-size: 1rem; }

  p.helper {
    font-size: 0.83rem;
    color: var(--text-muted);
    margin-bottom: 1.25rem;
    line-height: 1.6;
  }
</style>
</head>
<body>
<div class="container">
  <header>
    <h1>EFT Calculator</h1>
    <span>Equivalent Full-Time Student Tool</span>
  </header>

  <!-- Step 1 -->
  <div class="card">
    <div class="card-title">Step 1 â€” Select Qualification</div>
    <div class="field">
      <label>Qualification</label>
      <select id="qualSelect">
        <option value="">â€” Choose a qualification â€”</option>
      </select>
    </div>
    <div id="eftBadge" style="display:none;">
      <div class="eft-badge">EFT Rate per student: <strong id="eftRateDisplay">â€”</strong></div>
    </div>
  </div>

  <!-- Step 2 -->
  <div class="card">
    <div class="card-title">Step 2 â€” Calculation Mode</div>
    <div class="toggle-row">
      <button class="toggle-btn active" id="btnStudents" onclick="setMode('students')">Students â†’ EFT</button>
      <button class="toggle-btn red" id="btnEft" onclick="setMode('eft')">EFT â†’ Students</button>
    </div>

    <!-- Students to EFT -->
    <div class="mode-panel visible" id="panelStudents">
      <div class="field">
        <label>Number of Students</label>
        <input type="number" id="studentCount" min="1" placeholder="e.g. 20" oninput="calcFromStudents()">
      </div>
      <div class="result-box" id="resultStudents" style="display:none;">
        <div>
          <div class="result-label">Total EFT</div>
          <div class="result-value" id="eftResult">â€”</div>
        </div>
        <div style="text-align:right;">
          <div class="result-label">Calculation</div>
          <div class="formula-text" id="calcFormula">â€”</div>
        </div>
      </div>
    </div>

    <!-- EFT to Students -->
    <div class="mode-panel" id="panelEft">
      <div class="field">
        <label>Target EFT Amount</label>
        <input type="number" id="eftTarget" min="0.001" step="0.001" placeholder="e.g. 10.5" oninput="calcFromEft()">
      </div>
      <div class="result-box" id="resultEft" style="display:none;">
        <div>
          <div class="result-label">Students Required</div>
          <div class="result-value red" id="studentsResult">â€”</div>
        </div>
        <div style="text-align:right;">
          <div class="result-label">Exact / Rounded Up</div>
          <div class="formula-text" id="exactStudents">â€”</div>
        </div>
      </div>
    </div>
  </div>

  <!-- Step 3 -->
  <div class="card">
    <div class="card-title yellow">Step 3 â€” Year Weighting (Optional)</div>
    <p class="helper">Enter class start and end dates. The tool calculates what percentage of class weeks fall within the current calendar year â€” with the Christmas shutdown (14 Dec â€“ 15 Jan) excluded â€” then applies that percentage to your EFT total.</p>
    <div class="row">
      <div class="field">
        <label>Class Start Date</label>
        <input type="date" id="startDate" oninput="calcDateWeight()">
      </div>
      <div class="field">
        <label>Class End Date</label>
        <input type="date" id="endDate" oninput="calcDateWeight()">
      </div>
    </div>

    <div id="dateResults" style="display:none;">
      <div class="three-col">
        <div class="mini-stat">
          <div class="val" id="totalWeeks" style="color:var(--text);">â€”</div>
          <div class="lbl">Class Weeks (excl. shutdown)</div>
        </div>
        <div class="mini-stat">
          <div class="val" id="weeksInYear" style="color:var(--accent3);">â€”</div>
          <div class="lbl">Weeks in <span id="currentYearLabel"></span> (excl. shutdown)</div>
        </div>
        <div class="mini-stat">
          <div class="val" id="yearPercent" style="color:var(--accent);">â€”</div>
          <div class="lbl">Year %</div>
        </div>
      </div>

      <div id="shutdownNotice" style="display:none;">
        <div class="shutdown-note">
          <span class="icon">ðŸŽ„</span>
          <span id="shutdownText"></span>
        </div>
      </div>

      <div class="result-box" style="margin-top:1rem;">
        <div>
          <div class="result-label">Year-Weighted EFT</div>
          <div class="result-value yellow" id="weightedEft">â€”</div>
        </div>
        <div style="text-align:right;">
          <div class="result-label">Formula</div>
          <div class="formula-text" id="weightFormula">â€”</div>
        </div>
      </div>
      <div class="result-box" id="weightedStudentsBox" style="margin-top:0.75rem; display:none; background:var(--accent2-light); border-color:rgba(192,57,43,0.2);">
        <div>
          <div class="result-label">Students needed to reach your EFT target<br><span style="font-size:0.65rem;opacity:0.7;">(accounting for year weighting)</span></div>
          <div class="result-value red" id="weightedStudentsResult">â€”</div>
        </div>
        <div style="text-align:right;">
          <div class="result-label">Exact / Rounded Up</div>
          <div class="formula-text" id="weightedStudentsFormula">â€”</div>
        </div>
      </div>
      <div class="date-note" id="dateNote"></div>
    </div>
  </div>
</div>

<script>
const qualifications = [
  ["Animal Care L3", 0.5833],
  ["Construction Supervision L5 Online", 0.5838],
  ["Construction Commercial L5 Online", 0.5838],
  ["Diverse Learning Needs L4", 0.333],
  ["Small Business Management L4", 0.5],
  ["First Line Management L4", 0.5],
  ["Landscape Design L3", 0.625],
  ["Horticulture L3", 0.5],
  ["Baking L4", 1],
  ["Cookery L5", 1],
  ["Cookery L4", 1],
  ["Construction L3", 1],
  ["Paint and Plaster L3", 0.5],
  ["Early Childhood Education L4", 0.5],
  ["Early Childhood Education L5", 1],
  ["Electrical L3", 1],
  ["Personal Training L4", 0.5],
  ["Advanced Fitness Coach L5", 0.5],
  ["Food and Beverage L3", 0.5],
  ["Food and Beverage L4", 0.5],
  ["Foundation Skills L2", 0.5],
  ["Health and Wellbeing L3", 0.5833],
  ["Health and Wellbeing L4", 1],
  ["Hospitality L5", 1],
  ["Hospitality L6", 1],
  ["Plumbing L3", 0.6],
  ["Pharmacy L3", 0.35],
  ["Pharmacy L5", 1.1668],
  ["Pre-Nursing L4", 0.5],
  ["Pre-Police L3", 0.5],
  ["Sports Rec L3", 0.5],
  ["Sports Rec L5", 1],
  ["Sports Rec L6", 1],
  ["Construction Management L6", 1],
  ["Business Admin & Technology L3", 0.5],
  ["BCATS Trades L2", 0.6667],
  ["Apiculture L3", 0.5417],
  ["Pest Operations L3", 0.5001],
  ["Primary Industry Op Skills L3 - Infrastructure", 0.4169],
  ["Primary Industry Op Skills L3 - Rural Operational Skills", 0.335],
  ["Primary Industry Op Skills L3 - Specialist Equipment", 0.4169],
  ["Primary Industry Op Skills L3 - Specialist Equipment & Infrastructure", 0.5003],
  ["Primary Industry Production Management L5", 0.5833],
  ["Vocational Pathways - PI - Agriculture L2", 0.667],
  ["Agriculture L4 - Dairy", 1.0417],
  ["Agriculture L4 - Breeding Livestock", 1],
  ["Agriculture L4 - Non Breeding Livestock", 0.8333],
  ["Agriculture Farming Systems L3", 0.7084],
  ["Vocational Pathways - PI - Horticulture L2", 0.6667],
  ["Sustainable Primary Production L4", 0.5833],
  ["Vocational Pathways - C&I - BCATS", 0.6667],
  ["Vocational Pathways - C&I - Civil", 0.6667],
];

const sel = document.getElementById('qualSelect');
qualifications.sort((a, b) => a[0].localeCompare(b[0]));
qualifications.forEach(([name, eft]) => {
  const opt = document.createElement('option');
  opt.value = eft;
  opt.textContent = `${name}  (${eft})`;
  sel.appendChild(opt);
});

let currentEftRate = null;
let currentMode = 'students';
let computedEftTotal = null;

sel.addEventListener('change', () => {
  const v = parseFloat(sel.value);
  if (isNaN(v)) {
    currentEftRate = null;
    document.getElementById('eftBadge').style.display = 'none';
  } else {
    currentEftRate = v;
    document.getElementById('eftRateDisplay').textContent = v;
    document.getElementById('eftBadge').style.display = 'block';
  }
  recalcAll();
});

function setMode(mode) {
  currentMode = mode;
  document.getElementById('btnStudents').classList.toggle('active', mode === 'students');
  document.getElementById('btnEft').classList.toggle('active', mode === 'eft');
  document.getElementById('panelStudents').classList.toggle('visible', mode === 'students');
  document.getElementById('panelEft').classList.toggle('visible', mode === 'eft');
  recalcAll();
}

function calcFromStudents() {
  const n = parseFloat(document.getElementById('studentCount').value);
  const box = document.getElementById('resultStudents');
  if (!currentEftRate || isNaN(n) || n <= 0) {
    box.style.display = 'none';
    computedEftTotal = null;
    calcDateWeight();
    return;
  }
  const total = n * currentEftRate;
  computedEftTotal = total;
  document.getElementById('eftResult').textContent = total.toFixed(4);
  document.getElementById('calcFormula').textContent = `${n} Ã— ${currentEftRate} = ${total.toFixed(4)}`;
  box.style.display = 'flex';
  calcDateWeight();
}

function calcFromEft() {
  const t = parseFloat(document.getElementById('eftTarget').value);
  const box = document.getElementById('resultEft');
  if (!currentEftRate || isNaN(t) || t <= 0) {
    box.style.display = 'none';
    computedEftTotal = null;
    calcDateWeight();
    return;
  }
  const exact = t / currentEftRate;
  const rounded = Math.ceil(exact);
  // Use the entered EFT target as the base for year weighting
  computedEftTotal = t;
  document.getElementById('studentsResult').textContent = rounded;
  document.getElementById('exactStudents').textContent = `Exact: ${exact.toFixed(3)} â†’ â†‘${rounded}`;
  box.style.display = 'flex';
  calcDateWeight();
}

function recalcAll() {
  if (currentMode === 'students') calcFromStudents();
  else calcFromEft();
}

// Calculate effective days in [rangeStart, rangeEnd) excluding Christmas shutdowns.
// Shutdown repeats annually: Dec 14 of year Y to Jan 15 of year Y+1.
function effectiveDays(rangeStart, rangeEnd) {
  if (rangeEnd <= rangeStart) return 0;

  const startYear = rangeStart.getFullYear();
  const endYear = rangeEnd.getFullYear();
  const shutdowns = [];

  for (let y = startYear - 1; y <= endYear + 1; y++) {
    shutdowns.push([
      new Date(y, 11, 14),    // Dec 14, year y
      new Date(y + 1, 0, 15)  // Jan 15, year y+1
    ]);
  }

  let totalMs = rangeEnd - rangeStart;
  let shutdownMs = 0;

  shutdowns.forEach(([sS, sE]) => {
    const oS = rangeStart > sS ? rangeStart : sS;
    const oE = rangeEnd < sE ? rangeEnd : sE;
    if (oE > oS) shutdownMs += oE - oS;
  });

  return Math.max(0, totalMs - shutdownMs) / 86400000;
}

function calcDateWeight() {
  const startVal = document.getElementById('startDate').value;
  const endVal = document.getElementById('endDate').value;
  const container = document.getElementById('dateResults');

  if (!startVal || !endVal) { container.style.display = 'none'; return; }

  const start = new Date(startVal + 'T00:00:00');
  const end = new Date(endVal + 'T00:00:00');
  if (end <= start) { container.style.display = 'none'; return; }

  const currentYear = new Date().getFullYear();
  document.getElementById('currentYearLabel').textContent = currentYear;

  // Total effective days for whole class
  const totalEffectiveDays = effectiveDays(start, end);
  const totalEffectiveWeeks = totalEffectiveDays / 7;

  // Clip to current year
  const yearStart = new Date(currentYear, 0, 1);
  const yearEnd = new Date(currentYear + 1, 0, 1); // Jan 1 next year (exclusive)

  const overlapStart = start < yearStart ? yearStart : start;
  const overlapEnd = end > yearEnd ? yearEnd : end;

  let weeksInYear = 0;
  let pct = 0;

  if (overlapEnd > overlapStart) {
    const effectiveInYear = effectiveDays(overlapStart, overlapEnd);
    weeksInYear = effectiveInYear / 7;
    pct = totalEffectiveDays > 0 ? effectiveInYear / totalEffectiveDays : 0;
  }

  // Show Christmas shutdown notice if it overlaps the class
  const shutdowns = [
    [new Date(currentYear - 1, 11, 14), new Date(currentYear, 0, 15)],
    [new Date(currentYear, 11, 14),     new Date(currentYear + 1, 0, 15)],
  ];

  let shutdownMsg = '';
  shutdowns.forEach(([sS, sE]) => {
    if (start < sE && end > sS) {
      const sYear = sS.getFullYear();
      shutdownMsg = `Christmas shutdown (14 Dec ${sYear} â€“ 15 Jan ${sYear + 1}) overlaps with this class and has been excluded from the week count.`;
    }
  });

  const notice = document.getElementById('shutdownNotice');
  notice.style.display = shutdownMsg ? 'block' : 'none';
  if (shutdownMsg) document.getElementById('shutdownText').textContent = shutdownMsg;

  document.getElementById('totalWeeks').textContent = totalEffectiveWeeks.toFixed(2);
  document.getElementById('weeksInYear').textContent = weeksInYear.toFixed(2);
  document.getElementById('yearPercent').textContent = (pct * 100).toFixed(1) + '%';

  container.style.display = 'block';

  const weightedStudentsBox = document.getElementById('weightedStudentsBox');

  if (computedEftTotal !== null) {
    const weighted = computedEftTotal * pct;
    document.getElementById('weightedEft').textContent = weighted.toFixed(4);
    document.getElementById('weightFormula').textContent =
      `${computedEftTotal.toFixed(4)} Ã— ${(pct * 100).toFixed(1)}% = ${weighted.toFixed(4)}`;
    document.getElementById('dateNote').innerHTML =
      `Class runs <strong>${totalEffectiveWeeks.toFixed(2)} effective weeks</strong> in total. ` +
      `<strong>${weeksInYear.toFixed(2)} weeks</strong> fall within ${currentYear} ` +
      `(<strong>${(pct * 100).toFixed(1)}%</strong>). ` +
      `Year-weighted EFT = <strong>${weighted.toFixed(4)}</strong>.`;

    // In EFTâ†’Students mode, show how many students are needed to reach the
    // original EFT target once year-weighting is applied.
    // Because only a fraction (pct) of the class falls in this year, you need
    // MORE students so that pct Ã— students Ã— eftRate = targetEFT.
    // i.e. students = targetEFT / (pct Ã— eftRate)
    if (currentMode === 'eft' && currentEftRate && pct > 0) {
      const exactWeighted = computedEftTotal / (pct * currentEftRate);
      const roundedWeighted = Math.ceil(exactWeighted);
      weightedStudentsBox.style.display = 'flex';
      document.getElementById('weightedStudentsResult').textContent = roundedWeighted;
      document.getElementById('weightedStudentsFormula').textContent =
        `Exact: ${exactWeighted.toFixed(3)} â†’ â†‘${roundedWeighted}`;
    } else {
      weightedStudentsBox.style.display = 'none';
    }
  } else {
    document.getElementById('weightedEft').textContent = 'â€”';
    document.getElementById('weightFormula').textContent = 'Complete Steps 1 & 2 to see weighted EFT';
    document.getElementById('dateNote').innerHTML =
      `Class runs <strong>${totalEffectiveWeeks.toFixed(2)} effective weeks</strong> in total. ` +
      `<strong>${weeksInYear.toFixed(2)} weeks</strong> fall within ${currentYear} ` +
      `(<strong>${(pct * 100).toFixed(1)}%</strong>). Select a qualification and enter values above to see weighted EFT.`;
    weightedStudentsBox.style.display = 'none';
  }
}
</script>
</body>
</html>
